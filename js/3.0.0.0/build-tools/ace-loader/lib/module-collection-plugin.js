"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_newArrowCheck2=_interopRequireDefault(require("@babel/runtime/helpers/newArrowCheck")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_RawSource=_interopRequireDefault(require("webpack-sources/lib/RawSource")),path=require("path"),_require=require("webpack"),Compilation=_require.Compilation,moduleReg=/(@ohos|@system)(\.[a-zA-Z]+)+/g,ModuleCollectionPlugin=function(){function e(){(0,_classCallCheck2.default)(this,e)}return(0,_createClass2.default)(e,[{key:"apply",value:function(e){var r=this;e.hooks.thisCompilation.tap("rich",function(e){var t=this;(0,_newArrowCheck2.default)(this,r),e.hooks.processAssets.tapAsync({name:"MyPlugin",stage:Compilation.PROCESS_ASSETS_STAGE_REPOR},function(r,i){var a=this;(0,_newArrowCheck2.default)(this,t);var l=[];Object.keys(r).forEach(function(e){if((0,_newArrowCheck2.default)(this,a),".js"===path.extname(e)){var t=r[e].source().match(moduleReg);t&&t.forEach(function(e){l.push(e.replace("@",""))})}}.bind(this)),e.assets["./module_collection.txt"]=new _RawSource.default(0===l.length?"NULL":l.join(",")),i&&i()}.bind(this))}.bind(this))}}]),e}();module.exports=ModuleCollectionPlugin;