var parser=require("@babel/parser"),traverse=require("@babel/traverse").default,generate=require("@babel/generator").default;function parseExpression(e,r){const t=new RegExp("^(NaN\\b|isNaN\\b|isFinite\\b|decodeURI\\b|decodeURIComponent\\b|Math\\b|Date\\b|this\\b|true\\b|false\\b|\n    encodeURI\\b|encodeURIComponent\\b|parseInt\\b|parseFloat\\b|null\\b|undefined\\b|Infinity\\b)","g"),n=new RegExp("^(var\\b|while\\b|with\\b|yield\\b|enum\\b|await\\b|implements\\b|package\\b|for\\b|function\\b|if\\b|import\\b|\n    protected\\b|static\\b|interface\\b|private\\b|public\\b|break\\b|case\\b|class\\b|catch\\b|const\\b|continue\\b|debugger\\b|\n    default\\b|delete\\b|do\\b|else\\b|export\\b|extends\\b|finally\\b|in\\b|instanceof\\b|let\\b|return\\b|super\\b|switch\\b|throw\\b|try\\b)","g"),b=new RegExp("^(var\\b|while\\b|with\\b|yield\\b|enum\\b|await\\b|implements\\b|package\\b|for\\b|function\\b|if\\b|import\\b|\n    protected\\b|static\\b|interface\\b|private\\b|public\\b|break\\b|case\\b|class\\b|catch\\b|const\\b|continue\\b|debugger\\b|\n    default\\b|delete\\b|do\\b|else\\b|export\\b|extends\\b|finally\\b|in\\b|instanceof\\b|let\\b|return\\b|super\\b|switch\\b|throw\\b|try\\b|show\\b|tid\\b)$","g");try{if(b.test(e))throw Error("A data binding parsing error occurred. Do not use the reserved:"+e).message;let a=r?parser.parse("("+e+")"):parser.parse(e);return traverse(a,{enter(e){if(e.parent&&"Identifier"===e.node.type){let r=!1;(r=!!(["ConditionalExpression","BinaryExpression"].includes(e.parent.type)||"CallExpression"===e.parent.type&&e.parent.callee===e.node)||("ObjectProperty"===e.parent.type&&!e.parent.computed&&e.parent.value===e.node||addPrefix(e.node,e.parent)))&&!t.test(e.node.name)&&(e.node.name="this."+e.node.name)}}}),generate(a,{compact:!0}).code.replace(";","").replace(/\"/g,"'").replace(/\n/g,"")}catch(t){throw r?n.test(e)?Error("An event parsing error occurred. Do not use the reserved:"+e).message:Error("An event parsing error occurred:"+e).message:n.test(e)?Error("A data binding parsing error occurred. Do not use the reserved:"+e).message:Error("A data binding parsing error occurred:"+e).message}}function addPrefix(e,r){const t=["expression","argument","arguments","expressions","elements","left","right"],n=["object","property","id","key"];let b=Object.keys(r);for(let n=0;n<t.length;n++)if(b.includes(t[n])){if(r[t[n]]===e||["expressions","elements"].includes(t[n])&&r[t[n]].includes(e))return!0;if("arguments"===t[n]&&"Identifier"===r.arguments[0].type)return!0}for(let t=0;t<n.length;t++)if(b.includes(n[t])){if(r.computed&&r[n[t]]===e)return!0;if("Property"===r.type&&r.key.range[0]===r.value.range[0]&&r.key.range[1]===r.value.range[1])e.name=e.name+":this."+e.name;else if(r.object===e)return!0}return!1}exports.parseExpression=parseExpression;