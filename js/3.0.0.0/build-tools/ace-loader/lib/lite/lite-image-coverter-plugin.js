"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_newArrowCheck2=_interopRequireDefault(require("@babel/runtime/helpers/newArrowCheck")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_path=require("path"),fs=require("fs"),registerRequireContextHook=require("babel-plugin-require-context-hook/register"),_require=require("./lite-enum"),REGEXP_PNG=_require.REGEXP_PNG,iconPath=process.env.iconPath||"",img2bin=require("./lite-image2bin");registerRequireContextHook();var ImageCoverterPlugin=function(){function e(r){(0,_classCallCheck2.default)(this,e),this.options=r}return(0,_createClass2.default)(e,[{key:"getDir",value:function(e){var r=this;return global.__requireContext("",e,!0,REGEXP_PNG).keys().map(function(t){return(0,_newArrowCheck2.default)(this,r),_path.join(e,t)}.bind(this))}},{key:"apply",value:function(e){var r=this.options.build,t=this.getDir;e.hooks.done.tap("image coverter",function(e,i){var n=this,o=t(r),u=function(e){var t=this;(0,_newArrowCheck2.default)(this,n),fs.writeFile(_path.resolve(r,"image_convert_result.txt"),e,function(e){if((0,_newArrowCheck2.default)(this,t),e)return console.error(e)}.bind(this))}.bind(this);if(o.length>0){var a=o.map(function(e){return(0,_newArrowCheck2.default)(this,n),img2bin(e)}.bind(this));Promise.all(a).then(function(){(0,_newArrowCheck2.default)(this,n),u("{exitCode:0}")}.bind(this)).catch(function(){(0,_newArrowCheck2.default)(this,n),u("{exitCode:1}")}.bind(this))}else u("{exitCode:0}");""!==iconPath&&t(iconPath).forEach(function(e){(0,_newArrowCheck2.default)(this,n),img2bin(e)}.bind(this))})}}]),e}();module.exports=ImageCoverterPlugin;