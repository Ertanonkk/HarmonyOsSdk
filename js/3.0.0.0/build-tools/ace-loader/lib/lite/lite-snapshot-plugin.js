"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_newArrowCheck2=_interopRequireDefault(require("@babel/runtime/helpers/newArrowCheck")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_require=require("child_process"),exec=_require.exec,_path=require("path"),snapshot=_path.join(__dirname,"..","..","bin","jerry-snapshot"),registerRequireContextHook=require("babel-plugin-require-context-hook/register");registerRequireContextHook();var SnapshotPlugin=function(){function e(t){(0,_classCallCheck2.default)(this,e),this.options=t}return(0,_createClass2.default)(e,[{key:"getDir",value:function(e,t){var r=this,i=[];return Object.keys(e).map(function(e){(0,_newArrowCheck2.default)(this,r),/.js$/.test(e)&&i.push(_path.join(t,e))}.bind(this)),i}},{key:"apply",value:function(e){var t=this,r=this.options.build;e.hooks.done.tap("snapshot coverter",function(e){var i=this;(0,_newArrowCheck2.default)(this,t),this.getDir(e.compilation.assets,r).forEach(function(e){var t=this;(0,_newArrowCheck2.default)(this,i);var r=e.replace(".js",".bc"),a=_path.basename(e);exec('"'.concat(snapshot,'" generate -o "').concat(r,'" "').concat(e,'"'),function(e){(0,_newArrowCheck2.default)(this,t),e&&console.error("[31m","Failed to convert the ".concat(a," file to a snapshot."),"[39m")}.bind(this))}.bind(this))}.bind(this))}}]),e}();module.exports=SnapshotPlugin;