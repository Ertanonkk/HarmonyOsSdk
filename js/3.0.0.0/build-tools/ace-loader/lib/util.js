"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNameByPath=getNameByPath,exports.getFileNameWithHash=getFileNameWithHash,exports.getFilenameByPath=getFilenameByPath,exports.stringifyFunction=stringifyFunction,exports.logWarn=logWarn,exports.getRequireString=getRequireString,exports.stringifyLoaders=stringifyLoaders,exports.generateMap=generateMap,exports.consumeMap=consumeMap,exports.splitSourceLine=splitSourceLine,exports.printSourceWithLine=printSourceWithLine,exports.loadBabelModule=loadBabelModule,exports.parseRequireModule=parseRequireModule,exports.jsonLoaders=jsonLoaders,exports.FUNC_END_REG=exports.FUNC_END=exports.FUNC_START_REG=exports.FUNC_START=void 0;var _newArrowCheck2=_interopRequireDefault(require("@babel/runtime/helpers/newArrowCheck")),_path=_interopRequireDefault(require("path")),_loaderUtils=_interopRequireDefault(require("loader-utils")),_hashSum=_interopRequireDefault(require("hash-sum")),_sourceMap=require("source-map");function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var r=0,t=function(){};return{s:t,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,o=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var _require=require("./lite/lite-enum"),DEVICE_LEVEL=_require.DEVICE_LEVEL;function getNameByPath(e){return _path.default.basename(e).replace(/\..*$/,"")}function getFileNameWithHash(e,r){var t=_path.default.relative(".",e),n=(0,_hashSum.default)(t+r);return"./".concat(t,"?").concat(n)}function getFilenameByPath(e){return _path.default.relative(".",e)}var FUNC_START="#####FUN_S#####";exports.FUNC_START=FUNC_START;var FUNC_START_REG=new RegExp("[\"']"+FUNC_START,"g");exports.FUNC_START_REG=FUNC_START_REG;var FUNC_END="#####FUN_E#####";exports.FUNC_END=FUNC_END;var FUNC_END_REG=new RegExp(FUNC_END+"[\"']","g");function stringifyFunction(e,r){return"function"==typeof r?FUNC_START+r.toString()+FUNC_END:r}function logWarn(e,r){var t=this,n=!1;return process.env.logLevel>0&&r&&r.length&&r.forEach(function(r){(0,_newArrowCheck2.default)(this,t),r.reason.startsWith("NOTE")&&parseInt(process.env.logLevel)<=1?r.line&&r.column?e.emitWarning("noteStartNOTE File："+e.resourcePath+":"+r.line+":"+r.column+"\n "+r.reason.replace("NOTE: ","")+"noteEnd"):e.emitWarning("noteStartNOTE File："+e.resourcePath+"\n "+r.reason.replace("NOTE: ","")+"noteEnd"):r.reason.startsWith("WARN")&&parseInt(process.env.logLevel)<=2?r.line&&r.column?e.emitWarning("warnStartWARNING File："+e.resourcePath+":"+r.line+":"+r.column+"\n "+r.reason.replace("WARNING: ","")+"warnEnd"):e.emitWarning("warnStartWARNING File："+e.resourcePath+"\n "+r.reason.replace("WARNING: ","")+"warnEnd"):r.reason.startsWith("ERROR")&&parseInt(process.env.logLevel)<=3&&(n=!0,r.line&&r.column?e.emitError("errorStartERROR File："+e.resourcePath+":"+r.line+":"+r.column+"\n "+r.reason.replace("ERROR: ","")+"errorEnd"):e.emitError("errorStartERROR File："+e.resourcePath+"\n "+r.reason.replace("ERROR: ","")+"errorEnd"))}.bind(this)),n}function getRequireString(e,r,t){return"require("+_loaderUtils.default.stringifyRequest(e,r?"!!".concat(r,"!").concat(t):"".concat(t))+")\n"}function stringifyLoaders(e){var r=this;return e.map(function(e){if((0,_newArrowCheck2.default)(this,r),"string"==typeof e)return e;var t=e.name,n=[];if(e.query)for(var a in e.query){var o=e.query[a];null!=o&&(!0===o?n.push(a):o instanceof Array?n.push("".concat(a,"[]=").concat(o.join(","))):n.push("".concat(a,"=").concat(o)))}return"".concat(t).concat(n.length?"?"+n.join("&"):"")}.bind(this)).join("!")}function generateMap(e,r,t){var n=getFileNameWithHash(e.resourcePath),a=_path.default.resolve("."),o=new _sourceMap.SourceMapGenerator({sourceRoot:a,skipValidation:!0});o.setSourceContent(n,r);var i,s=_createForOfIteratorHelper(t);try{for(s.s();!(i=s.n()).done;){var u=i.value,l=u.original,c=u.generated;o.addMapping({source:n,original:l,generated:c})}}catch(e){s.e(e)}finally{s.f()}return o}function consumeMap(e,r,t){var n,a=this,o=new _sourceMap.SourceMapConsumer(t),i=[],s=[],u={};return splitSourceLine(r).forEach(function(e,r){(0,_newArrowCheck2.default)(this,a);r+=1;var t=o.originalPositionFor({line:r,column:0});t.source&&(n=t.source,i.push({line:t.line,column:t.column}),s.push({line:r,column:0}),u["line-".concat(r,"-column-").concat(0)]={line:t.line,column:t.column})}.bind(this)),{source:n,original:i,generated:s,mapping:u,sourcesContent:o.sourcesContent}}exports.FUNC_END_REG=FUNC_END_REG;var LINE_REG=/\r?\n/g;function splitSourceLine(e){return e.split(LINE_REG)}function printSourceWithLine(e){var r=this;console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),e=splitSourceLine(e).map(function(e,t){(0,_newArrowCheck2.default)(this,r),console.log(t+1+":",e)}.bind(this)),console.log("<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<")}function loadBabelModule(e){try{var r=require.resolve(e);return r.slice(0,r.indexOf(e.replace(/\//g,_path.default.sep))+e.length)}catch(r){return e}}function parseRequireModule(e){var r=this,t=process.env.DEVICE_LEVEL===DEVICE_LEVEL.LITE?"\nfunction requireModule(moduleName) {\n  return requireNative(moduleName.slice(1));\n}\n":"\nfunction requireModule(moduleName) {\n  const systemList = ['system.router', 'system.app', 'system.prompt', 'system.configuration',\n  'system.image', 'system.device', 'system.mediaquery', 'ohos.animator', 'system.grid', 'system.resource']\n  var target = ''\n  if (systemList.includes(moduleName.replace('@', ''))) {\n    target = $app_require$('@app-module/' + moduleName.substring(1));\n    return target;\n  }\n  var shortName = moduleName.replace(/@[^.]+.([^.]+)/, '$1');\n  if (typeof ohosplugin !== 'undefined' && /@ohos/.test(moduleName)) {\n    target = ohosplugin;\n    for (let key of shortName.split('.')) {\n      target = target[key];\n      if(!target) {\n        break;\n      }\n    }\n    if (typeof target !== 'undefined') {\n      return target;\n    }\n  }\n  if (typeof systemplugin !== 'undefined') {\n    target = systemplugin;\n    for (let key of shortName.split('.')) {\n      target = target[key];\n      if(!target) {\n        break;\n      }\n    }\n    if (typeof target !== 'undefined') {\n      return target;\n    }\n  }\n  target = requireNapi(shortName);\n  return target;\n}\n",n=/require\(['"]([^()]+)['"]\)/g,a=/^lib(.+)\.so$/,o=(e="".concat(e,"\n").concat(t)).match(n);if(o&&o.length){var i,s=_createForOfIteratorHelper(o);try{for(s.s();!(i=s.n()).done;){var u=i.value;(u.indexOf("@system")>0||u.indexOf("@ohos")>0)&&(e=e.replace(u,u.replace("require","requireModule")))}}catch(e){s.e(e)}finally{s.f()}}return e=e.replace(n,function(e,t){return(0,_newArrowCheck2.default)(this,r),a.test(t)&&(e='requireNapi("'.concat(t.replace(a,"$1"),'", true)')),e}.bind(this))}function jsonLoaders(e,r,t,n){var a=[];switch(e){case"template":a=[{name:_path.default.resolve(__dirname,"json.js")},{name:_path.default.resolve(__dirname,"template.js")}];break;case"style":a=[{name:_path.default.resolve(__dirname,"json.js")},{name:_path.default.resolve(__dirname,"style.js")}];break;case"json":a=[{name:_path.default.resolve(__dirname,"json.js")}]}return r&&a.push({name:_path.default.resolve(__dirname,"../node_modules/".concat(r))}),t&&a.push({name:_path.default.resolve(__dirname,"extgen.js"),query:{type:n}}),stringifyLoaders(a)}