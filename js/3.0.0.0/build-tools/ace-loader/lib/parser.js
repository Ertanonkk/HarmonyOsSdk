"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseFragment=parseFragment,exports.parseTemplate=parseTemplate,exports.parseStyle=parseStyle,exports.parseScript=parseScript;var _newArrowCheck2=_interopRequireDefault(require("@babel/runtime/helpers/newArrowCheck")),_parse=_interopRequireDefault(require("parse5")),_templater=_interopRequireDefault(require("./templater")),_styler=_interopRequireDefault(require("./styler")),_scripter=_interopRequireDefault(require("./scripter")),_component_validator=require("./templater/component_validator"),_util=require("./util");function getAttribute(e,t){if(e.attrs)for(var r,i=e.attrs.length;i--;)if((r=e.attrs[i]).name===t)return r.value}function extractDependencies(e,t){var r=this;e.childNodes&&e.childNodes.forEach(function(e){(0,_newArrowCheck2.default)(this,r),(0,_component_validator.checkTagName)(e,{result:{},deps:t,log:[]}),extractDependencies(e,t)}.bind(this))}function parseFragment(e){var t=this,r={deps:[],element:[],template:[],style:[],script:[],data:[],config:[]};return _parse.default.parseFragment(e,{locationInfo:!0}).childNodes.forEach(function(e){var i;if((0,_newArrowCheck2.default)(this,t),"script"===e.tagName?"data"!==(i=getAttribute(e,"type"))&&"config"!==i&&(i="script"):i=e.tagName,"we-element"===i&&(console.warn('<we-element name="'.concat(getAttribute(e,"name"),'"> is deprecated, please use <element> instead.')),i="element"),r[i]){var a=getAttribute(e,"name"),n=getAttribute(e,"src"),s=getAttribute(e,"lang");if(r[i].push({name:a,src:n,lang:s,node:e}),"template"===i){var l=[];extractDependencies(e.content,l),r.deps=l}}}.bind(this)),r}function parseTemplate(e,t){var r=this;return new Promise(function(i,a){var n=this;(0,_newArrowCheck2.default)(this,r),_templater.default.parse(e,function(e,t){if((0,_newArrowCheck2.default)(this,n),e)a(e);else{var r=JSON.stringify(t.jsonTemplate,_util.stringifyFunction,"  ");r=r.replace(_util.FUNC_START_REG,"").replace(_util.FUNC_END_REG,""),i({parsed:r,log:t.log})}}.bind(this),t)}.bind(this))}function parseStyle(e,t){var r=this;return new Promise(function(i,a){var n=this;(0,_newArrowCheck2.default)(this,r),_styler.default.parse(e,function(e,t){if((0,_newArrowCheck2.default)(this,n),e)a(e);else{var r=JSON.stringify(t.jsonStyle,null,2);i({parsed:r,log:t.log})}}.bind(this),t)}.bind(this))}function parseScript(e){var t=this;return new Promise(function(r,i){(0,_newArrowCheck2.default)(this,t),r({parsed:_scripter.default.fix(e)})}.bind(this))}