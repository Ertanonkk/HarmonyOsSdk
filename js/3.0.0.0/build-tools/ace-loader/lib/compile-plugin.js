"use strict";var mStats,_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_newArrowCheck2=_interopRequireDefault(require("@babel/runtime/helpers/newArrowCheck")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_this2=void 0,Stats=require("webpack/lib/Stats"),fs=require("fs"),path=require("path"),_require=require("./lite/lite-enum"),DEVICE_LEVEL=_require.DEVICE_LEVEL,REG=/\([^\)]+\)/,mErrorCount=0,mWarningCount=0,isShowError=!0,isShowWarning=!0,isShowNote=!0,warningCount=0,noteCount=0,errorCount=0,ResultStates=function(){function r(e){(0,_classCallCheck2.default)(this,r),this.options=e}return(0,_createClass2.default)(r,[{key:"apply",value:function(r){var e=this,t=this.options.build;r.hooks.done.tap("Result States",function(r){(0,_newArrowCheck2.default)(this,e),warningCount=0,noteCount=0,errorCount=0,(mStats=r).compilation.errors&&(mErrorCount=mStats.compilation.errors.length),mStats.compilation.warnings&&(mWarningCount=mStats.compilation.warnings.length),"false"===process.env.error&&(isShowError=!1),"false"===process.env.warning&&(isShowWarning=!1),"false"===process.env.note&&(isShowNote=!1),printResult(t)}.bind(this))}}]),r}(),red="[31m",yellow="[33m",blue="[34m",reset="[39m",writeError=function(r,e){var t=this;(0,_newArrowCheck2.default)(this,_this2),fs.writeFile(path.resolve(r,"compile_error.log"),e,function(r){if((0,_newArrowCheck2.default)(this,t),r)return console.error(r)}.bind(this))}.bind(void 0);function printResult(r){if(printWarning(),printError(r),errorCount+warningCount+noteCount>0){var e,t={};errorCount>0?(t.ERROR=errorCount,e="FAIL "):e="SUCCESS ",warningCount>0&&(t.WARN=warningCount),noteCount>0&&(t.NOTE=noteCount),console.log(blue,"COMPILE RESULT:"+e+JSON.stringify(t),reset)}else console.log(blue,"COMPILE RESULT:SUCCESS ",reset)}function printWarning(){if(mWarningCount>0){for(var r=mStats.compilation.warnings,e=r.length,t=0;t<e;t++){var n=r[t].message;null!==n.match(/noteStart(([\s\S])*)noteEnd/)?(noteCount++,isShowNote&&console.info(" "+n.match(/noteStart(([\s\S])*)noteEnd/)[1].trim(),reset,"\n")):null!==n.match(/warnStart(([\s\S])*)warnEnd/)&&(warningCount++,isShowWarning&&console.warn(yellow,n.match(/warnStart(([\s\S])*)warnEnd/)[1].trim(),reset,"\n"))}mWarningCount>e&&(warningCount=warningCount+mWarningCount-e)}}function printError(r){if(mErrorCount>0){var e=mStats.compilation.errors,t=e.length;if(isShowError){for(var n="",o=0;o<t;o++)if(e[o]){var i=e[o].message;if(i){if(null!==i.match(/errorStart(([\s\S])*)errorEnd/)){var s=i.match(/errorStart(([\s\S])*)errorEnd/)[1];console.error(red,s.trim(),reset,"\n")}else!function(){var r=this,e="";i.split("\n").forEach(function(t){(0,_newArrowCheck2.default)(this,r),/^at/.test(t.trim())||(e=e+t+"\n")}.bind(this)),console.error(red,e,reset,"\n")}();errorCount++,n+=i}}writeError(r,n)}}}module.exports=ResultStates;