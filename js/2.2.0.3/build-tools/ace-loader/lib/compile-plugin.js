"use strict";function _classCallCheck(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function _createClass(r,n,t){return n&&_defineProperties(r.prototype,n),t&&_defineProperties(r,t),r}var mStats,Stats=require("webpack/lib/Stats"),argv=require("yargs").argv,fs=require("fs"),path=require("path"),_require=require("./lite/lite-enum"),DEVICE_LEVEL=_require.DEVICE_LEVEL,REG=/\([^\)]+\)/,mErrorCount=0,mWarningCount=0,isShowError=!0,isShowWarning=!0,isShowNote=!0,warningCount=0,noteCount=0,errorCount=0,ResultStates=function(){function r(n){_classCallCheck(this,r),this.options=n}return _createClass(r,[{key:"apply",value:function(r){var n=this.options.build;r.hooks.done.tap("Result States",function(r){warningCount=0,noteCount=0,errorCount=0,(mStats=r).compilation.errors&&(mErrorCount=mStats.compilation.errors.length),mStats.compilation.warnings&&(mWarningCount=mStats.compilation.warnings.length),"false"===argv.error&&(isShowError=!1),"false"===argv.warning&&(isShowWarning=!1),"false"===argv.note&&(isShowNote=!1),printResult(n)})}}]),r}(),red="[31m",yellow="[33m",blue="[34m",reset="[39m",writeError=function(r,n){fs.writeFile(path.resolve(r,"compile_error.log"),n,function(r){if(r)return console.error(r)})};function printResult(r){if(printWarning(),printError(r),errorCount+warningCount+noteCount>0){var n,t={};errorCount>0?(t.ERROR=errorCount,n="FAIL "):n="SUCCESS ",warningCount>0&&(t.WARN=warningCount),noteCount>0&&(t.NOTE=noteCount),console.log(blue,"COMPILE RESULT:"+n+JSON.stringify(t),reset)}else console.log(blue,"COMPILE RESULT:SUCCESS ",reset)}function printWarning(){if(mWarningCount>0){for(var r=mStats.compilation.warnings,n=r.length,t=0;t<n;t++){var e=r[t].message;null!==e.match(/noteStart(([\s\S])*)noteEnd/)?(noteCount++,isShowNote&&console.info(" "+e.match(/noteStart(([\s\S])*)noteEnd/)[1].trim(),reset,"\n")):null!==e.match(/warnStart(([\s\S])*)warnEnd/)&&(warningCount++,isShowWarning&&console.warn(yellow,e.match(/warnStart(([\s\S])*)warnEnd/)[1].trim(),reset,"\n"))}mWarningCount>n&&(warningCount=warningCount+mWarningCount-n)}}function printError(r){if(mErrorCount>0){var n=mStats.compilation.errors,t=n.length;if(isShowError){for(var e="",o=0;o<t;o++)if(n[o]){var i=n[o].message;if(i){if(null!==i.match(/errorStart(([\s\S])*)errorEnd/)){var a=i.match(/errorStart(([\s\S])*)errorEnd/)[1];console.error(red,a.trim(),reset,"\n")}else!function(){var r="";i.split("\n").forEach(function(n){/^at/.test(n.trim())||(r=r+n+"\n")}),console.error(red,r,reset,"\n")}();errorCount++,e+=i}}writeError(r,e)}}}module.exports=ResultStates;