"use strict";function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var _loaderUtils=_interopRequireDefault(require("loader-utils")),_path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs")),config=_interopRequireWildcard(require("./config")),legacy=_interopRequireWildcard(require("./legacy")),_parser=require("./parser"),_util=require("./util"),_component_validator=require("./templater/component_validator"),_sassLoader=_interopRequireDefault(require("sass-loader"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=a?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _require=require("./lite/lite-enum"),DEVICE_LEVEL=_require.DEVICE_LEVEL,loaderPath=__dirname,defaultLoaders={none:"",main:_path.default.resolve(loaderPath,"loader.js"),extract:_path.default.resolve(loaderPath,"extract.js"),template:_path.default.resolve(loaderPath,"template.js"),style:_path.default.resolve(loaderPath,"style.js"),script:_path.default.resolve(loaderPath,"script.js"),json:_path.default.resolve(loaderPath,"json.js"),babel:(0,_util.loadBabelModule)("babel-loader"),manifest:_path.default.resolve(loaderPath,"manifest-loader.js"),extgen:_path.default.resolve(loaderPath,"extgen.js")};function getLoaderString(e,t){var r=loadCustomLoader(t=t||{});switch(e){case"main":return mainLoaderString(void 0);case"element":return elementLoaderString(void 0,t);case"template":return templateLoaderString(void 0,t,r);case"style":return styleLoaderString(void 0,t,r);case"script":return scriptLoaderString(void 0,t,r);case"config":return configLoaderString(void 0,t);case"data":return dataLoaderString(void 0,t);default:return}}function loadCustomLoader(e){if(e.lang&&e.customLang[e.lang])return(0,_util.loadBabelModule)(e.customLang[e.lang][0])}function mainLoaderString(e){return e=[{name:defaultLoaders.main}],(0,_util.stringifyLoaders)(e)}function elementLoaderString(e,t){return e=[{name:defaultLoaders.main,query:{element:!t.source||void 0}}],t.source||e.push({name:defaultLoaders.extract,query:{index:t.name,type:"elements"}}),(0,_util.stringifyLoaders)(e)}function templateLoaderString(e,t,r){return e=[{name:defaultLoaders.json},{name:defaultLoaders.template}],r&&(e=e.concat(r)),t.source||e.push({name:defaultLoaders.extract,query:{type:"template"}}),t.element&&e.push({name:defaultLoaders.extract,query:{index:t.elementName,type:"elements"}}),e.push({name:defaultLoaders.extgen,query:{type:"template"}}),(0,_util.stringifyLoaders)(e)}function styleLoaderString(e,t,r){return e=[{name:defaultLoaders.json},{name:defaultLoaders.style}],r&&(e=e.concat(r)),t.source||e.push({name:defaultLoaders.extract,query:{index:0,type:"styles"}}),t.element&&e.push({name:defaultLoaders.extract,query:{index:t.elementName,type:"elements"}}),e.push({name:defaultLoaders.extgen,query:{type:"style"}}),(0,_util.stringifyLoaders)(e)}function scriptLoaderString(e,t,r){return e=[{name:defaultLoaders.script}],r?e=e.concat(r):e.push({name:defaultLoaders.babel,query:{presets:[(0,_util.loadBabelModule)("@babel/preset-env")],plugins:[(0,_util.loadBabelModule)("@babel/plugin-transform-modules-commonjs")],comments:"false"}}),t.source||e.push({name:defaultLoaders.extract,query:{index:0,type:"scripts"}}),t.element&&e.push({name:defaultLoaders.extract,query:{index:t.elementName,type:"elements"}}),t.app&&e.push({name:defaultLoaders.manifest,query:{path:t.source}}),(0,_util.stringifyLoaders)(e)}function configLoaderString(e,t){return e=[{name:defaultLoaders.json}],t.source||e.push({name:defaultLoaders.extract,query:{type:"config"}}),(0,_util.stringifyLoaders)(e)}function dataLoaderString(e,t){return e=[{name:defaultLoaders.json}],t.source||e.push({name:defaultLoaders.extract,query:{type:"data"}}),(0,_util.stringifyLoaders)(e)}function codegenHmlAndCss(){var e=(this._compiler.options.plugins[0].options.options.weex||{}).lang||{},t=(_loaderUtils.default.getOptions(this)||{}).element,r=(this.resourceQuery&&_loaderUtils.default.parseQuery(this.resourceQuery)||{}).entry,a="",n=this.resourcePath.replace(process.env.aceSuperVisualPath,process.env.aceModuleRoot);return n=n.substr(0,n.length-6)+"js",a="var $app_script$ = "+(0,_util.getRequireString)(this,getLoaderString("script",{customLang:e,lang:void 0,element:void 0,elementName:void 0,source:n}),n),a+="var $app_template$ = "+(0,_util.getRequireString)(this,getLoaderString("template",{customLang:e,lang:void 0,element:t,elementName:void 0,source:this.resourcePath}),this.resourcePath),a+="var $app_style$ = "+(0,_util.getRequireString)(this,getLoaderString("style",{customLang:e,lang:void 0,element:t,elementName:void 0,source:this.resourcePath}),this.resourcePath),a+="\n    $app_define$('@app-component/".concat((0,_util.getNameByPath)(this.resourcePath),"', [], function($app_require$, $app_exports$, $app_module$) {\n    ")+"\n    $app_script$($app_module$, $app_exports$, $app_require$)\n    if ($app_exports$.__esModule && $app_exports$.default) {\n    $app_module$.exports = $app_exports$.default\n    }\n    \n    $app_module$.exports.template = $app_template$\n    \n    $app_module$.exports.style = $app_style$\n    \n    })\n    ",r&&(a+="$app_bootstrap$('@app-component/".concat((0,_util.getNameByPath)(this.resourcePath),"'")+",undefined,undefined)"),a}module.exports=codegenHmlAndCss;